<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Maharashtra Cultural Map</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    svg { width: 90%; height: auto; margin: auto; display: block; }
    .district { fill: #87CEEB; stroke: #333; stroke-width: 1px; transition: 0.3s; }
    .district:hover { fill: orange; cursor: pointer; }
    .district:focus { outline: 2px solid #f59e0b; outline-offset: 2px; }
    .district.selected { fill: orange; stroke: #111827; stroke-width: 1.5px; }
    .spinner { border: 3px solid #e5e7eb; border-top: 3px solid #111827; border-radius: 9999px; width: 36px; height: 36px; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body class="bg-gray-100 flex flex-col items-center p-6">
  <h1 class="text-3xl font-bold mb-6">Cultural Map of Maharashtra</h1>

  <!-- Injected SVG (replace placeholder below with the full SVG content provided by the user) -->
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 600" aria-labelledby="title desc" role="img">
    <title id="title">Maharashtra Cultural Map (placeholder)</title>
    <desc id="desc">Interactive map of Maharashtra districts. Replace this placeholder with the full SVG.</desc>
    <rect x="0" y="0" width="800" height="600" fill="#e5e7eb" />
    <g id="placeholder-districts">
      <rect id="district-1" class="district" x="100" y="150" width="200" height="150" />
      <rect id="district-2" class="district" x="350" y="220" width="200" height="150" />
    </g>
  </svg>

  <!-- Modal -->
  <div id="districtModal" class="hidden fixed inset-0 bg-black/60 flex items-center justify-center z-50">
    <div class="bg-white rounded-2xl shadow-lg w-11/12 md:w-3/4 lg:w-1/2 p-6 relative" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <button id="modalClose" class="absolute top-3 right-3 text-gray-500 hover:text-black text-2xl" aria-label="Close">&times;</button>
      <div id="modalLoading" class="flex items-center justify-center h-32">
        <div class="spinner" aria-label="Loading"></div>
      </div>
      <div id="modalContent" class="hidden">
        <h2 id="modalTitle" class="text-2xl font-bold mb-3"></h2>
        <div class="flex flex-col sm:flex-row gap-4">
          <img id="modalImage" alt="" class="hidden w-36 h-36 object-cover rounded-md flex-shrink-0">
          <p id="modalSummary" class="text-gray-700 leading-relaxed"></p>
        </div>
        <a id="modalLink" href="#" target="_blank" rel="noopener" class="text-amber-600 hover:text-amber-800 font-semibold mt-4 inline-block">Read on Wikipedia â†’</a>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const modal = document.getElementById('districtModal');
      const modalClose = document.getElementById('modalClose');
      const modalLoading = document.getElementById('modalLoading');
      const modalContent = document.getElementById('modalContent');
      const titleEl = document.getElementById('modalTitle');
      const summaryEl = document.getElementById('modalSummary');
      const imageEl = document.getElementById('modalImage');
      const linkEl = document.getElementById('modalLink');

      function setLoading(isLoading) {
        modalLoading.classList.toggle('hidden', !isLoading);
        modalContent.classList.toggle('hidden', isLoading);
      }

      function openModal() {
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
      }

      function closeModal() {
        modal.classList.add('hidden');
        document.body.style.overflow = '';
      }

      modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
      });
      modalClose.addEventListener('click', closeModal);
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeModal();
      });

      function normalizeDistrictName(raw) {
        if (!raw) return '';
        let name = raw;
        name = name.replace(/_/g, ' ').replace(/-/g, ' ');
        name = name.replace(/\b(layer|district)\b/gi, '').replace(/\s+/g, ' ').trim();
        name = name.split(' ').map(w => w.charAt(0).toUpperCase() + w.slice(1).toLowerCase()).join(' ');
        const exceptions = {
          'Mumbai': 'Mumbai City',
          'Mumbai City': 'Mumbai City',
          'Mumbai Suburban': 'Mumbai Suburban',
          'Thane': 'Thane',
          'Pune': 'Pune',
          'Nashik': 'Nashik',
          'Nagpur': 'Nagpur'
        };
        return exceptions[name] || name;
      }

      async function fetchSummaryREST(title) {
        try {
          const url = 'https://en.wikipedia.org/api/rest_v1/page/summary/' + encodeURIComponent(title);
          const res = await fetch(url, { headers: { 'Accept': 'application/json' } });
          if (!res.ok) return null;
          const data = await res.json();
          if (!data || data.type === 'https://mediawiki.org/wiki/HyperSwitch/errors/not_found') return null;
          return data;
        } catch {
          return null;
        }
      }

      async function searchWikipedia(query) {
        try {
          const url = 'https://en.wikipedia.org/w/api.php?action=query&list=search&srsearch=' + encodeURIComponent(query) + '&format=json&origin=*';
          const res = await fetch(url);
          if (!res.ok) return null;
          const data = await res.json();
          const first = data?.query?.search?.[0];
          return first ? first.title : null;
        } catch {
          return null;
        }
      }

      async function getWikipediaInfo(districtName) {
        const candidates = [
          districtName + ' district, Maharashtra',
          districtName + ' district',
          districtName + ', Maharashtra',
          districtName
        ];
        for (const title of candidates) {
          const summary = await fetchSummaryREST(title);
          if (summary) return summary;
        }
        const searchedTitle = await searchWikipedia(districtName + ' district Maharashtra');
        if (searchedTitle) {
          const summary = await fetchSummaryREST(searchedTitle);
          if (summary) return summary;
        }
        return null;
      }

      function setSelectedDistrict(el) {
        document.querySelectorAll('.district.selected').forEach(d => d.classList.remove('selected'));
        if (el) el.classList.add('selected');
      }

      async function handleDistrictClick(el) {
        setSelectedDistrict(el);
        openModal();
        setLoading(true);
        const rawName = el.getAttribute('data-name') || el.getAttribute('title') || el.id || '';
        const districtName = normalizeDistrictName(rawName);
        let wiki = await getWikipediaInfo(districtName);
        if (!wiki && districtName.endsWith(' City')) {
          wiki = await getWikipediaInfo(districtName.replace(' City', ''));
        }
        if (wiki) {
          titleEl.textContent = wiki.title || (districtName + ' district');
          summaryEl.textContent = wiki.extract || wiki.description || 'No summary available.';
          if (wiki.thumbnail?.source) {
            imageEl.src = wiki.thumbnail.source;
            imageEl.alt = wiki.title || districtName;
            imageEl.classList.remove('hidden');
          } else {
            imageEl.classList.add('hidden');
            imageEl.removeAttribute('src');
            imageEl.removeAttribute('alt');
          }
          const pageUrl = wiki.content_urls?.desktop?.page || ('https://en.wikipedia.org/wiki/' + encodeURIComponent(wiki.title || (districtName + ' district, Maharashtra')));
          linkEl.href = pageUrl;
        } else {
          titleEl.textContent = districtName ? (districtName + ' district') : 'District';
          summaryEl.textContent = 'Could not fetch information right now.';
          imageEl.classList.add('hidden');
          const fallbackUrl = 'https://en.wikipedia.org/w/index.php?search=' + encodeURIComponent(districtName + ' district Maharashtra');
          linkEl.href = fallbackUrl;
        }
        setLoading(false);
      }

      document.querySelectorAll('.district').forEach(district => {
        district.style.cursor = 'pointer';
        district.setAttribute('tabindex', '0');
        district.setAttribute('role', 'button');
        district.addEventListener('click', () => handleDistrictClick(district));
        district.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            handleDistrictClick(district);
          }
        });
      });
    });
  </script>
</body>
</html>